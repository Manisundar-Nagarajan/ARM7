//#include<stdlib.h>
#include"lcd.h"
void uart0_config(void);
void uart0_tx(unsigned char);
unsigned char uart0_rx(void);
void uart0_str(char *);
void uart0_isr(void) __irq;

char a[50];
volatile char data = 0;
volatile int i=0;

int main()			
{
 PINSEL0 |= 0x5;
 uart0_config();
 lcd_init(); 
 VICIntSelect = 0;
 VICVectCntl1 = (0x20)|6;
 VICVectAddr1 = (unsigned long)uart0_isr;
 U0IER = (1<<0)|(1<<1);
 VICIntEnable |= (1<<6);
 
 while(1)
 {
   lcd_cmd(0x80);
   lcd_string("*Digital Notice*");

   if(a[i-1] == '\n')
   {
    a[i-2] = '\0';
	i = 0;
	uart0_str(a);
	lcd_cmd(0xC0);
	lcd_string(a);
	delay_ms(5000);
	lcd_cmd(0x01);
   }
 
   if(((IOPIN0>>2)&1) == 0)
   {
    volatile static unsigned char a = 0;
	a++;
	delay_ms(50);
	uart0_tx('\r');
	uart0_tx('\n');
	uart0_str("Stu ID:");
	if(a < 10) uart0_tx(a+48);
	else if(a >= 10 && a < 100)
	{
	 uart0_tx(a/10+48);
	 uart0_tx(a%10+48);
	}
	if(a == 100)a = 0;
	uart0_str("   MSG:");
	uart0_tx(a%10+48);
	while(((IOPIN0>>2)&1) == 0);
   }	
 }
}

void uart0_config(void)
{
 U0LCR = 0x83;
 U0DLL = 97;
 U0DLM = 0;
 U0LCR = 0x03;
}

void uart0_isr(void) __irq
{
 int temp;
 temp = U0IIR;
 if(temp == 0x04)
 {
    while(U0LSR & 0x01)
	{
	 a[i++] = U0RBR;
	}
 } 
 VICVectAddr = 0;
}

void uart0_tx(unsigned char tx)
{
 U0THR = tx;
 while(((U0LSR>>5)&1) == 0);
}

unsigned char uart0_rx(void)
{
 while((U0LSR & 1)== 0);
 return U0RBR;
}

void uart0_str(char *s)
{
 while(*s)
 {
  uart0_tx(*s++);
 }
}

