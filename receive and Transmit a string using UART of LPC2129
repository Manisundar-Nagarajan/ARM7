//Write an ECP to receive and Transmit a string using UART of LPC2129

#include<LPC21XX.H>
#define LCD 0xff
#define RS 1<<8
#define E 1<<9
void LCD_INIT(void);
void LCD_CMD(unsigned char);
void LCD_DATA(unsigned char);
void delay_ms(unsigned int);
void UART_config(void);
void UART_Tx(unsigned char);
unsigned char UART_Rx(void);
void UART_Str(unsigned char *);

int main()
	{
	unsigned char s[30];
	unsigned char ch;
	unsigned char i=0;
	  PINSEL0|=0x5;
	  UART_config();
	  while(1)
	  {
	  if((ch=UART_Rx())!='\r')
	  {
	  s[i++]=ch;
	  }
	  else
	  {
		s[i]='\0';
		UART_Str(s);
		i=0;
	   }
	  }
	}
	
	void UART_config(void)
	{		
				U0LCR=0x83;
				U0DLL=97;
				U0DLM=0;
				U0LCR=0x03;
	}
	
	void UART_Tx(unsigned char ch)
	{
		U0THR=ch;
		while(((U0LSR>>5)&1)==0);
	}
	
	unsigned char UART_Rx(void)
	{
		while((U0LSR&1)==0);
		return U0RBR;
	}
	
	void UART_Str(unsigned char *ch)
	{
	while(*ch)
	UART_Tx(*ch++);
	}
	void LCD_INIT(void)
	{
	IODIR0=LCD|RS|E;
	LCD_CMD(0x01);
	LCD_CMD(0x02);
	LCD_CMD(0x0c);
	LCD_CMD(0x38);
	}
	void LCD_CMD(unsigned char CMD)
	{
	IOCLR0=LCD;
	IOSET0=CMD;
	IOCLR0=RS;
	IOSET0=E;
	delay_ms(250);
	IOCLR0=E;
	}
	void LCD_DATA(unsigned char DATA)
	{
	IOCLR0=LCD;
	IOSET0=DATA;
	IOSET0=RS;
	IOSET0=E;
	delay_ms(250);
	IOCLR0=E;
	}
	void delay_ms(unsigned int ms)
	{
	T0PR=15000-1;
	T0TCR=0x01;
	while(T0TC<ms);
	T0TCR=0x03;
	T0TCR=0x00;
	}
